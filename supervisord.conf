[supervisord]
nodaemon=true
user=appuser
# Write supervisord logs to the mounted app logs directory so host can read them
logfile=/app/logs/supervisord.log
pidfile=/app/supervisord.pid
childlogdir=/app/logs
loglevel=info

[unix_http_server]
file=/tmp/supervisor.sock
chmod=0700
chown=appuser:appuser

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

# Backend service configuration
[program:backend]
command=node index.js
directory=/app/backend
user=appuser
autostart=true
autorestart=true
stderr_logfile=/app/logs/backend_error.log
stdout_logfile=/app/logs/backend_access.log
environment=PORT="%(ENV_BACKEND_PORT)s",NODE_ENV="%(ENV_NODE_ENV)s"
priority=1
startsecs=3
startretries=3

# Chat backend service configuration  
[program:chatbackend]
command=node index.js
directory=/app/chatbackend
user=appuser
autostart=true
autorestart=true
stderr_logfile=/app/logs/chatbackend_error.log
stdout_logfile=/app/logs/chatbackend_access.log
environment=PORT="%(ENV_CHATBACKEND_PORT)s",NODE_ENV="%(ENV_NODE_ENV)s"
priority=2
startsecs=3
startretries=3

# Group both services for easier management
[group:kidsden-services]
programs=backend,chatbackend
priority=999